<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Profile/Profile.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Profile/Profile.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * React component for rendering user profile details and settings.
 * @module Profile
 * @component
 * @requires React
 * @requires Main
 * @requires Button
 * @requires user.context
 * @requires Breadcrumbs
 * @requires Header
 * @requires ProfileStyles
 * @requires Modal
 * @requires react-feather
 * @requires Footer
 * @requires PageTitle
 * @requires Subheading
 * @requires Divider
 * @requires Card
 * @requires useToggle
 * @requires Loader
 */

/**
 * @module Profile
 * @description React component for rendering user profile details and settings.
 * @returns {JSX.Element} Rendered component.
 */

import React, { useState, useEffect, useRef } from 'react';
import Main from '../../components/Main/Main';
import Button from '../../components/Button';
import { useUser } from '../../../api/context/user.context';
import Breadcrumbs from '../../components/Breadcrumbs';
import Header from '../../components/Header/Header';
import {
	ProfileContainer,
	ProfileSection,
	InputField,
	SaveButton,
	ProfileSettings,
	TextInputWrapper,
	EmailEditContainer,
	EmailEditMessage,
	EmailEditInputContainer,
	CancelButton,
	ErrorMessage,
} from './ProfileStyles';
import Modal from '../../components/Modal';
import { Edit, ArrowRight } from 'react-feather';
import Footer from '../../components/Footer';
import PageTitle from '../../components/PageTitle';
import Subheading from '../../components/Subheading';
import Divider from '../../components/Divider';
import Card from '../../components/Card';
import useToggle from '../../hooks/useToggle.hook';
import Loader from '../../components/Loader/Loader';

function Profile() {
	const { user, update } = useUser();
	const [firstname, setFirstname] = useState('');
	const [lastname, setLastname] = useState('');
	const [email, setEmail] = useState('');
	const [profileUrl, setProfileUrl] = useState('');
	const [isEditing, setIsEditing] = useState({
		firstname: false,
		lastname: false,
		email: false,
	});
	const [showEmailModal, toggleEmailModal] = useToggle(false);
	const [password, setPassword] = useState('');
	const fileInputRef = useRef(null);
	const inputRef = useRef({ firstname: null, lastname: null, email: null });
	const [isUploading, toggleisUploading] = useToggle(false);
	const [formErrorMessage, setFormErrorMessage] = useState('');
	/**
	 * useEffect hook to update component state when user data changes.
	 */
	useEffect(() => {
		if (user) {
			setFirstname(user?.name.split(' ')[0]);
			setLastname(user?.name.split(' ')[1]);
			setEmail(user?.email);
			setProfileUrl(user?.photo);
		}
	}, [user]);
	/**
	 * Toggles the edit mode for a specified field.
	 * @function toggleEdit
	 * @param {string} field - The field to toggle edit mode for (e.g., 'firstname', 'lastname', 'email').
	 */

	const toggleEdit = (field) => {
		setIsEditing((prev) => {
			const isFieldEditing = !prev[field];
			if (isFieldEditing) {
				setTimeout(() => inputRef.current[field]?.focus(), 0);
			}
			return { ...prev, [field]: isFieldEditing };
		});
	};
	/**
	 * Cancels the edit mode for a specified field and resets the field value to the original value.
	 * @function cancelEdit
	 * @param {string} field - The field to cancel edit mode for (e.g., 'firstname', 'lastname').
	 */
	const cancelEdit = (field) => {
		setIsEditing((prev) => ({ ...prev, [field]: false }));

		if (field === 'firstname') setFirstname(user?.name.split(' ')[0]);
		if (field === 'lastname') setLastname(user?.name.split(' ')[1]);
	};

	const handleCancelEmailEdit = () => {
		setEmail(user?.email);
		setFormErrorMessage('');
		toggleEmailModal();
	};

	/**
	 * Handles the update of the first name.
	 * @function handleFirstNameUpdate
	 */
	const handleFirstNameUpdate = () => {
		update.name(firstname + ' ' + lastname);
		toggleEdit('firstname');
	};

	/**
	 * Handles the update of the last name.
	 * @function handleLastNameUpdate
	 */
	const handleLastNameUpdate = () => {
		update.name(firstname + ' ' + lastname);
		toggleEdit('lastname');
	};

	const handleEmailEdit = () => {
		setIsEditing((prev) => ({ ...prev, email: true }));
	};

	/**
	 * Handles the focus-out event for the email input field.
	 * @function handleEmailFocusOut
	 */

	const handleEmailFocusOut = () => {
		if (email !== user?.email) {
			toggleEmailModal();
		}
		setIsEditing((prev) => ({ ...prev, email: false }));
	};

	/**
	 * Handles the email update process.
	 * @async
	 * @function handleEmailUpdate
	 * @param {Event} event - The event object.
	 */
	const handleEmailUpdate = async (event) => {
		if (event) {
			event.preventDefault();
		}

		try {
			await update.email(email, password);
			toggleEmailModal();
			setFormErrorMessage('');
		} catch (error) {
			console.error(error);
			setFormErrorMessage(error.message);
		}
	};

	/**
	 * Handles the profile image update.
	 * @function handleProfileImageUpdate
	 */
	const handleProfileImageUpdate = () => {
		fileInputRef.current.click();
	};

	/**
	 * Handles the change event for the file input, triggering the profile image update.
	 * @async
	 * @param {Event} event - The event object.
	 */
	const handleFileChange = async (event) => {
		const file = event.target.files[0];
		if (file) {
			toggleisUploading();
			try {
				await update.photo(file);
				toggleisUploading();
			} catch (error) {
				console.error(error.message);
				toggleisUploading();
			}
		}
	};

	/**
	 * Renders the JSX for the Profile component.
	 * @returns {JSX.Element} - Rendered component.
	 */
	return (
		&lt;>
			&lt;Header />
			&lt;Main>
				&lt;Breadcrumbs />
				&lt;PageTitle>Profile&lt;/PageTitle>
				&lt;ProfileContainer>
					{user &amp;&amp; (
						&lt;>
							&lt;ProfileSection>
								&lt;Loader isLoading={isUploading}>
									&lt;Card
										variant="profile"
										imageSrc={profileUrl}
										imageAlt="Profile image">
										&lt;input
											type="file"
											style={{ display: 'none' }}
											ref={fileInputRef}
											onChange={handleFileChange}
										/>
										&lt;Button
											variant="secondary"
											iconfirst={true}
											size="medium"
											icon={Edit}
											onClick={handleProfileImageUpdate}>
											Edit Profile Image
										&lt;/Button>
										&lt;p style={{ fontWeight: '700' }}>{user.name}&lt;/p>
										&lt;p>{user.email}&lt;/p>
									&lt;/Card>
								&lt;/Loader>
							&lt;/ProfileSection>

							&lt;ProfileSettings>
								&lt;Subheading>Account settings&lt;/Subheading>
								{/* First Name Input */}
								&lt;TextInputWrapper>
									&lt;label htmlFor="first-name-update-input">First Name&lt;/label>
									&lt;InputField
										id="first-name-update-input"
										ref={(el) => (inputRef.current.firstname = el)}
										type="text"
										value={firstname}
										readOnly={!isEditing.firstname}
										$isEditing={isEditing.firstname}
										onChange={(e) => setFirstname(e.target.value)}
									/>
									{isEditing.firstname ? (
										&lt;>
											&lt;SaveButton onClick={handleFirstNameUpdate}>
												Save
											&lt;/SaveButton>
											&lt;CancelButton onClick={() => cancelEdit('firstname')}>
												Cancel
											&lt;/CancelButton>
										&lt;/>
									) : (
										&lt;Button
											variant="secondary"
											iconfirst={true}
											size="medium"
											icon={Edit}
											onClick={() => toggleEdit('firstname')}>
											Edit
										&lt;/Button>
									)}
								&lt;/TextInputWrapper>
								{/* Last Name Input */}
								&lt;TextInputWrapper>
									&lt;label htmlFor="last-name-update-input">Last Name&lt;/label>
									&lt;InputField
										id="last-name-update-input"
										ref={(el) => (inputRef.current.lastname = el)}
										type="text"
										value={lastname}
										readOnly={!isEditing.lastname}
										onChange={(e) => setLastname(e.target.value)}
										$isEditing={isEditing.lastname}
									/>
									{isEditing.lastname ? (
										&lt;>
											&lt;SaveButton onClick={handleLastNameUpdate}>
												Save
											&lt;/SaveButton>
											&lt;CancelButton onClick={() => cancelEdit('lastname')}>
												Cancel
											&lt;/CancelButton>
										&lt;/>
									) : (
										&lt;Button
											variant="secondary"
											iconfirst={true}
											size="medium"
											icon={Edit}
											onClick={() => toggleEdit('lastname')}>
											Edit
										&lt;/Button>
									)}
								&lt;/TextInputWrapper>
								{/* Email Input */}
								&lt;TextInputWrapper>
									&lt;label htmlFor="email-update-input">Email&lt;/label>
									&lt;InputField
										id="email-update-input"
										ref={(el) => (inputRef.current.email = el)}
										type="email"
										value={email}
										readOnly={!isEditing.email}
										$isEditing={isEditing.email}
										onChange={(e) => setEmail(e.target.value)}
										onBlur={handleEmailFocusOut}
									/>{' '}
									{isEditing.email ? (
										&lt;>
											&lt;SaveButton onClick={handleEmailEdit}>Save&lt;/SaveButton>
										&lt;/>
									) : (
										&lt;Button
											variant="secondary"
											iconfirst={true}
											size="medium"
											icon={Edit}
											onClick={() => toggleEdit('email')}>
											Edit
										&lt;/Button>
									)}
								&lt;/TextInputWrapper>
								{/* Email Edit Modal */}
								{showEmailModal &amp;&amp; (
									&lt;Modal
										title="Email Edit Modal"
										closeDialog={handleCancelEmailEdit}>
										&lt;EmailEditContainer>
											&lt;EmailEditMessage>
												Are you sure you want to change your email to:{' '}
												&lt;span>{email}&lt;/span>
												&lt;p>
													Please verify this is you by entering your password
													below:
												&lt;/p>
											&lt;/EmailEditMessage>
											&lt;EmailEditInputContainer>
												&lt;InputField
													type="password"
													placeholder="Enter password"
													onChange={(e) => setPassword(e.target.value)}
												/>
												&lt;SaveButton onClick={(e) => handleEmailUpdate(e)}>
													Confirm
												&lt;/SaveButton>
											&lt;/EmailEditInputContainer>
											{formErrorMessage &amp;&amp; (
												&lt;ErrorMessage>{formErrorMessage}&lt;/ErrorMessage>
											)}
										&lt;/EmailEditContainer>
									&lt;/Modal>
								)}

								&lt;Divider />
								&lt;Subheading>Reviews &amp; Favorites&lt;/Subheading>
								{/* Reviews and Favorites Buttons */}
								&lt;Button
									variant="secondary"
									iconfirst={true}
									size="medium"
									icon={ArrowRight}
									href="/reviews">
									My Reviews
								&lt;/Button>
								&lt;Button
									variant="secondary"
									iconfirst={true}
									size="medium"
									icon={ArrowRight}
									href="/favorites">
									&lt;span>Favourites&lt;/span>
								&lt;/Button>
							&lt;/ProfileSettings>
						&lt;/>
					)}
				&lt;/ProfileContainer>
			&lt;/Main>
		&lt;/>
	);
}

export default Profile;

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Home.html">Home</a></li><li><a href="module-Profile.html">Profile</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Fri Jan 05 2024 16:35:15 GMT+0200 (Eastern European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
